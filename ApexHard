local Fluent = loadstring(game:HttpGet("https://github.com/dawid-scripts/Fluent/releases/latest/download/main.lua"))()
local SaveManager = loadstring(game:HttpGet("https://raw.githubusercontent.com/dawid-scripts/Fluent/master/Addons/SaveManager.lua"))()
local InterfaceManager = loadstring(game:HttpGet("https://raw.githubusercontent.com/dawid-scripts/Fluent/master/Addons/InterfaceManager.lua"))()

local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")
local Workspace = game:GetService("Workspace")

local Window = Fluent:CreateWindow({
    Title = "XXMZ",
    SubTitle = "EB Apex Hard",
    TabWidth = 160,
    Size = UDim2.fromOffset(600, 400),
    Acrylic = true,
    Theme = "Dark",
    MinimizeKey = Enum.KeyCode.RightControl
})

local MainTab = Window:AddTab({ Title = "Main", Icon = "home" })

local AntiArrestEnabled = false
local AntiArrestToggle = MainTab:AddToggle("AntiArrestToggle", {
    Title = "Anti Arrest",
    Default = false
})
AntiArrestToggle:OnChanged(function(state)
    AntiArrestEnabled = state
end)

task.spawn(function()
    while true do
        if AntiArrestEnabled then
            for _, player in pairs(Players:GetPlayers()) do
                local arrestObj = player:FindFirstChild("Arrested Function")
                if arrestObj then
                    arrestObj:Destroy()
                    print("[Anti Arrest] Arrested Function removida de " .. player.Name)
                end
                if player.Backpack then
                    local backpackArrest = player.Backpack:FindFirstChild("Arrested Function")
                    if backpackArrest then
                        backpackArrest:Destroy()
                        print("[Anti Arrest] Arrested Function removida do Backpack de " .. player.Name)
                    end
                end
                if player.Character then
                    local charArrest = player.Character:FindFirstChild("Arrested Function")
                    if charArrest then
                        charArrest:Destroy()
                        print("[Anti Arrest] Arrested Function removida do Character de " .. player.Name)
                    end
                end
            end
            local workspaceArrest = Workspace:FindFirstChild("Arrested Function")
            if workspaceArrest then
                workspaceArrest:Destroy()
                print("[Anti Arrest] Arrested Function removida do Workspace")
            end
        end
        task.wait(0.5)
    end
end)

-- Invadir Base com Cooperação Toggle
local InvadirBaseEnabled = false

local InvadirBaseToggle = MainTab:AddToggle("InvadirBaseToggle", {
    Title = "Invadir Base com Cooperação",
    Description = "ATENÇÃO: Você deve estar perto do Portão do VIP para funcionar!",
    Default = false
})

InvadirBaseToggle:OnChanged(function(state)
    InvadirBaseEnabled = state
    if state then
        print("[Invadir Base] Monitoramento ativado - fique perto do Portão do VIP!")
    else
        print("[Invadir Base] Monitoramento desativado")
    end
end)

-- Função para encontrar o Portão do VIP
local function findPortaoVIP()
    local mapaEB = Workspace:FindFirstChild("MAPA DA EB")
    if not mapaEB then
        return nil
    end
    
    -- Procurar em todas as pastas (incluindo com nomes invisíveis)
    for _, folder in pairs(mapaEB:GetChildren()) do
        if folder:IsA("Folder") or folder:IsA("Model") then
            local portao = folder:FindFirstChild("Portão do VIP")
            if portao then
                return portao
            end
        end
    end
    
    return nil
end

-- Loop para monitorar o Portão do VIP
task.spawn(function()
    local lastCanCollide = nil
    
    while true do
        if InvadirBaseEnabled and LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart") then
            local portao = findPortaoVIP()
            if portao then
                -- Verificar se é uma Part ou procurar Parts dentro do modelo
                local partToCheck = nil
                if portao:IsA("Part") then
                    partToCheck = portao
                else
                    -- Se for um modelo, procurar a primeira Part dentro dele
                    for _, child in pairs(portao:GetChildren()) do
                        if child:IsA("Part") then
                            partToCheck = child
                            break
                        end
                    end
                end
                
                if partToCheck then
                    local currentCanCollide = partToCheck.CanCollide
                    
                    -- Se mudou de true para false (perdeu colisão)
                    if lastCanCollide == true and currentCanCollide == false then
                        -- Teleportar imediatamente
                        LocalPlayer.Character.HumanoidRootPart.CFrame = CFrame.new(2086, 1, -131)
                        print("[Invadir Base] Portão sem colisão detectado! Teleportando...")
                        
                        Fluent:Notify({
                            Title = "Invadir Base",
                            Content = "Portão aberto! Invadindo base...",
                            Duration = 3
                        })
                    end
                    
                    lastCanCollide = currentCanCollide
                else
                    print("[Invadir Base] Part do Portão do VIP não encontrada")
                end
            else
                print("[Invadir Base] Portão do VIP não encontrado")
            end
        end
        task.wait(0.1) -- Verificar a cada 0.1s para ser responsivo
    end
end)
local AntiDetectorEnabled = false
local savedDetector = nil
local detectorParent = nil

local AntiDetectorToggle = MainTab:AddToggle("AntiDetectorToggle", {
    Title = "Anti Detector",
    Description = "Remove o Detecto e restaura quando desativado",
    Default = false
})

AntiDetectorToggle:OnChanged(function(state)
    AntiDetectorEnabled = state
    
    if state then
        -- Ativar Anti Detector
        local mapaEB = Workspace:FindFirstChild("MAPA DA EB")
        if mapaEB then
            local deleteClient = mapaEB:FindFirstChild("DeleteClient")
            if deleteClient then
                local detecto = deleteClient:FindFirstChild("Detecto")
                if detecto then
                    savedDetector = detecto:Clone()
                    detectorParent = deleteClient
                    detecto:Destroy()
                    print("[Anti Detector] Detecto removido!")
                else
                    print("[Anti Detector] Detecto não encontrado!")
                end
            else
                print("[Anti Detector] DeleteClient não encontrado!")
            end
        else
            print("[Anti Detector] MAPA DA EB não encontrado!")
        end
    else
        -- Desativar Anti Detector (restaurar)
        if savedDetector and detectorParent then
            local newDetector = savedDetector:Clone()
            newDetector.Parent = detectorParent
            print("[Anti Detector] Detecto restaurado!")
        end
        savedDetector = nil
        detectorParent = nil
    end
end)

MainTab:AddButton({
    Title = "Equipar Feijão",
    Description = "Equipa o feijão automaticamente",
    Callback = function()
        if not LocalPlayer.Character or not LocalPlayer.Character:FindFirstChild("HumanoidRootPart") then
            Fluent:Notify({
                Title = "Equipar Feijão",
                Content = "Erro: Personagem não encontrado",
                Duration = 3
            })
            return
        end
        
        -- Teleportar rapidamente
        LocalPlayer.Character.HumanoidRootPart.CFrame = CFrame.new(1649, 2, 627)
        
        -- Aguardar muito pouco e interagir
        task.wait(0.01)
        
        local botFolder = Workspace:FindFirstChild("Bot")
        if not botFolder then
            Fluent:Notify({
                Title = "Equipar Feijão",
                Content = "Erro: Pasta 'Bot' não encontrada",
                Duration = 3
            })
            return
        end
        
        local foundProximity = false
        
        -- Procurar em todos os modelos sem nome na pasta Bot
        for _, model in pairs(botFolder:GetChildren()) do
            if model:IsA("Model") and model.Name == "" then
                local head = model:FindFirstChild("Head")
                if head then
                    local botao = head:FindFirstChild("Botão")
                    if botao then
                        for _, part in pairs(botao:GetDescendants()) do
                            if part:IsA("ProximityPrompt") then
                                fireproximityprompt(part)
                                foundProximity = true
                                Fluent:Notify({
                                    Title = "Equipar Feijão",
                                    Content = "Feijão equipado!",
                                    Duration = 3
                                })
                                print("[Equipar Feijão] Feijão equipado rapidamente!")
                                return
                            end
                        end
                    end
                end
            end
        end
        
        if not foundProximity then
            Fluent:Notify({
                Title = "Equipar Feijão",
                Content = "Erro: ProximityPrompt não encontrado",
                Duration = 3
            })
        end
    end
})

MainTab:AddButton({
    Title = "Verificar Caminhões",
    Description = "Conta quantos caminhões existem no servidor",
    Callback = function()
        local veiculosFolder = Workspace:FindFirstChild("Veiculos")
        if not veiculosFolder then
            Fluent:Notify({
                Title = "Caminhões",
                Content = "Erro: Reporte para o dono",
                Duration = 5
            })
            return
        end
        local qt01Count = 0
        for _, veiculo in pairs(veiculosFolder:GetChildren()) do
            if veiculo.Name == "QT-01" then
                qt01Count = qt01Count + 1
            end
        end
        if qt01Count > 0 then
            Fluent:Notify({
                Title = "Caminhões Encontrados!",
                Content = "Foram encontrados " .. qt01Count .. " caminhões nesse servidor.",
                Duration = 5
            })
        else
            Fluent:Notify({
                Title = "Nenhum Caminhão",
                Content = "Não foram encontrados caminhões nesse servidor.",
                Duration = 5
            })
        end
        print("[Verificar Caminhões] Encontrados " .. qt01Count .. " caminhões")
    end
})

MainTab:AddButton({
    Title = "Invadir Base",
    Description = "Fique perto da base",
    Callback = function()
        if LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart") then
            LocalPlayer.Character.HumanoidRootPart.CFrame = CFrame.new(1824, 1, -308)
        end
    end
})

local TpToolEnabled = false
local toolEquipped = false
local tool = nil

local TpToolToggle = MainTab:AddToggle("TpToolToggle", {
    Title = "Tp Tool",
    Description = "Ativa/desativa a ferramenta de teleporte",
    Default = false
})

local AntiHitEnabled = false
local AntiHitInterval = 1
local AntiHitPos = Vector3.new(-125.9238510131836, -4030.166748046875, -3148.517578125)

local AntiHitToggle = MainTab:AddToggle("AntiHitToggle", {
    Title = "Anti Hit",
    Default = false
})

AntiHitToggle:OnChanged(function(state)
    AntiHitEnabled = state
end)

local AntiHitSlider = MainTab:AddSlider("AntiHitSlider", {
    Title = "Intervalo (s)",
    Default = 1,
    Min = 0.1,
    Max = 5,
    Rounding = 1,
})

AntiHitSlider:OnChanged(function(value)
    AntiHitInterval = value
end)

-- Salvar posição da câmera
local camera = Workspace.CurrentCamera
local camCF = camera.CFrame

task.spawn(function()
    while true do
        task.wait(AntiHitInterval)
        if AntiHitEnabled and LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart") then
            -- Teleporta o jogador (HumanoidRootPart)
            LocalPlayer.Character.HumanoidRootPart.CFrame = CFrame.new(AntiHitPos)
            
            -- Reaplica a câmera original pra você não sentir o teleport
            camera.CFrame = camCF
        end
    end
end)


TpToolToggle:OnChanged(function(state)
    TpToolEnabled = state
    if TpToolEnabled then
        tool = Instance.new("Tool")
        tool.Name = "TpTool"
        tool.RequiresHandle = false
        tool.Parent = LocalPlayer.Backpack
        tool.Equipped:Connect(function()
            toolEquipped = true
        end)
        tool.Unequipped:Connect(function()
            toolEquipped = false
        end)
        print("[Tp Tool] Ferramenta criada! Equipe para usar.")
    else
        if tool then
            tool:Destroy()
            tool = nil
            toolEquipped = false
            print("[Tp Tool] Ferramenta removida.")
        end
    end
end)

local mouse = LocalPlayer:GetMouse()
mouse.Button1Down:Connect(function()
    if TpToolEnabled and toolEquipped then
        local targetPos = mouse.Hit.Position
        if LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart") then
            LocalPlayer.Character.HumanoidRootPart.CFrame = CFrame.new(targetPos + Vector3.new(0,3,0))
        end
    end
end)

local AimbotTab = Window:AddTab({ Title = "Aimbot", Icon = "crosshair" })

local AimbotEnabled = false
local AimbotSpeed = 0.5
local AimbotFOV = 100
local ShowFOV = false
local isHoldingRightMouse = false
local camera = Workspace.CurrentCamera

local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "FOVGui"
ScreenGui.Parent = game.CoreGui

local FOVFrame = Instance.new("Frame")
FOVFrame.Name = "FOVFrame"
FOVFrame.Size = UDim2.new(0, 200, 0, 200)
FOVFrame.Position = UDim2.new(0.5, -100, 0.5, -100)
FOVFrame.BackgroundTransparency = 1
FOVFrame.Parent = ScreenGui

local FOVCircle = Instance.new("TextLabel")
FOVCircle.Name = "FOVCircle"
FOVCircle.Size = UDim2.new(1, 0, 1, 0)
FOVCircle.Position = UDim2.new(0, 0, 0, 0)
FOVCircle.BackgroundTransparency = 1
FOVCircle.Text = "O"
FOVCircle.TextColor3 = Color3.fromRGB(255, 255, 255)
FOVCircle.TextScaled = true
FOVCircle.TextStrokeTransparency = 0
FOVCircle.TextStrokeColor3 = Color3.fromRGB(0, 0, 0)
FOVCircle.Font = Enum.Font.Code
FOVCircle.Visible = false
FOVCircle.Parent = FOVFrame

AimbotTab:AddToggle("ToggleAimbot", {
    Title = "Ativar Aimbot",
    Default = false,
}):OnChanged(function(state)
    AimbotEnabled = state
end)

AimbotTab:AddSlider("AimbotSpeed", {
    Title = "Velocidade do Aimbot",
    Default = 0.5,
    Min = 0.1,
    Max = 10,
    Rounding = 2,
}):OnChanged(function(value)
    AimbotSpeed = value
end)

AimbotTab:AddSlider("AimbotFOV", {
    Title = "FOV do Aimbot",
    Default = 100,
    Min = 50,
    Max = 500,
    Rounding = 0,
}):OnChanged(function(value)
    AimbotFOV = value
end)

AimbotTab:AddToggle("ShowFOV", {
    Title = "Mostrar FOV",
    Default = false,
}):OnChanged(function(state)
    ShowFOV = state
    FOVCircle.Visible = state
end)

UserInputService.InputBegan:Connect(function(input, gameProcessed)
    if not gameProcessed and input.UserInputType == Enum.UserInputType.MouseButton2 then
        isHoldingRightMouse = true
    end
end)

UserInputService.InputEnded:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton2 then
        isHoldingRightMouse = false
    end
end)

local function GetClosestPlayerToCursor()
    local mouseLocation = UserInputService:GetMouseLocation()
    local closestPlayer = nil
    local shortestDistance = math.huge

    for _, player in pairs(Players:GetPlayers()) do
        if player ~= LocalPlayer and player.Character and player.Character:FindFirstChild("HumanoidRootPart") and player.Character:FindFirstChild("Head") and player.Character:FindFirstChild("Humanoid") and player.Character.Humanoid.Health > 0 then
            local headPos, onScreen = camera:WorldToViewportPoint(player.Character.Head.Position)
            if onScreen then
                local screenPos = Vector2.new(headPos.X, headPos.Y)
                local distance = (screenPos - Vector2.new(mouseLocation.X, mouseLocation.Y)).Magnitude
                if distance < AimbotFOV and distance < shortestDistance then
                    shortestDistance = distance
                    closestPlayer = player
                end
            end
        end
    end

    return closestPlayer
end

RunService.Heartbeat:Connect(function()
    if ShowFOV and AimbotEnabled then
        local mouseLocation = UserInputService:GetMouseLocation()
        local fovSize = AimbotFOV * 2
        FOVFrame.Size = UDim2.new(0, fovSize, 0, fovSize)
        FOVFrame.Position = UDim2.new(0, mouseLocation.X - fovSize/2, 0, mouseLocation.Y - fovSize/2)
        FOVCircle.Visible = true
    else
        FOVCircle.Visible = false
    end
end)

local aimbotConnection
aimbotConnection = RunService.Heartbeat:Connect(function()
    if AimbotEnabled and isHoldingRightMouse and LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart") then
        local target = GetClosestPlayerToCursor()
        if target and target.Character and target.Character:FindFirstChild("Head") then
            local targetPos = target.Character.Head.Position
            local currentCFrame = camera.CFrame
            local direction = (targetPos - currentCFrame.Position).Unit
            local newCFrame = CFrame.lookAt(currentCFrame.Position, targetPos)
            camera.CFrame = currentCFrame:Lerp(newCFrame, AimbotSpeed * 0.02)
        end
    end
end)

-- Toggle Esconder Nome
local EsconderNomeEnabled = false
local originalTransparency = nil

local EsconderNomeToggle = MainTab:AddToggle("EsconderNomeToggle", {
    Title = "Esconder Nome (Visual)",
    Description = "Torna o nome do seu personagem invisível",
    Default = false
})

EsconderNomeToggle:OnChanged(function(state)
    EsconderNomeEnabled = state
    
    if LocalPlayer.Character then
        local nomeFolder = LocalPlayer.Character:FindFirstChild("Nome")
        if nomeFolder then
            local nomeTexto = nomeFolder:FindFirstChild("NomeTexto")
            if nomeTexto then
                if state then
                    -- Salvar transparência original antes de esconder
                    if originalTransparency == nil then
                        originalTransparency = nomeTexto.TextTransparency
                    end
                    nomeTexto.TextTransparency = 1 -- Torna invisível
                    print("[Esconder Nome] Nome escondido!")
                else
                    -- Restaurar transparência original
                    if originalTransparency ~= nil then
                        nomeTexto.TextTransparency = originalTransparency
                        originalTransparency = nil
                    else
                        nomeTexto.TextTransparency = 0 -- Valor padrão se não foi salvo
                    end
                    print("[Esconder Nome] Nome restaurado!")
                end
            else
                print("[Esconder Nome] NomeTexto não encontrado!")
            end
        else
            print("[Esconder Nome] Pasta Nome não encontrada!")
        end
    else
        print("[Esconder Nome] Personagem não encontrado!")
    end
end)

-- Monitorar quando o personagem respawnar para reaplicar o efeito
Players.LocalPlayer.CharacterAdded:Connect(function(character)
    if EsconderNomeEnabled then
        -- Aguardar o nome aparecer
        task.wait(1)
        local nomeFolder = character:FindFirstChild("Nome")
        if nomeFolder then
            local nomeTexto = nomeFolder:FindFirstChild("NomeTexto")
            if nomeTexto then
                if originalTransparency == nil then
                    originalTransparency = nomeTexto.TextTransparency
                end
                nomeTexto.TextTransparency = 1
                print("[Esconder Nome] Nome escondido após respawn!")
            end
        end
    end
end)

-- Input Visual Money
local originalCashValue = nil

local VisualMoneyInput = MainTab:AddInput("VisualMoneyInput", {
    Title = "Visual Money",
    Description = "Apenas números.",
    Default = "",
    Placeholder = "Max 1B",
    Numeric = true, -- Aceita apenas números
    Finished = false, -- Só executa quando pressionar Enter ou sair do campo
    Callback = function(value)
        local cashValue = tonumber(value)
        if not cashValue then
            Fluent:Notify({
                Title = "Visual Money",
                Content = "Por favor, digite apenas números!",
                Duration = 3
            })
            return
        end
        
        if LocalPlayer:FindFirstChild("Leaderboard") then
            local cashStat = LocalPlayer.Leaderboard:FindFirstChild("Cash")
            if cashStat then
                -- Salvar valor original na primeira vez
                if originalCashValue == nil then
                    originalCashValue = cashStat.Value
                end
                
                -- Alterar valor visual
                cashStat.Value = cashValue
                
                Fluent:Notify({
                    Title = "Visual Money",
                    Content = "Dinheiro alterado para: $" .. cashValue,
                    Duration = 3
                })
                print("[Visual Money] Valor alterado para: " .. cashValue)
            else
                Fluent:Notify({
                    Title = "Visual Money",
                    Content = "Erro: Cash não encontrado no Leaderboard",
                    Duration = 3
                })
            end
        else
            Fluent:Notify({
                Title = "Visual Money",
                                    Content = "Erro: Leaderboard não encontrado",
                Duration = 3
            })
        end
    end
})

-- Botão para restaurar valor original
MainTab:AddButton({
    Title = "Restaurar Dinheiro Original",
    Description = "Volta o dinheiro para o valor original",
    Callback = function()
        if originalCashValue ~= nil then
            if LocalPlayer:FindFirstChild("Leaderboard") then
                local cashStat = LocalPlayer.Leaderboard:FindFirstChild("Cash")
                if cashStat then
                    cashStat.Value = originalCashValue
                    Fluent:Notify({
                        Title = "Visual Money",
                        Content = "Dinheiro restaurado para: $" .. originalCashValue,
                        Duration = 3
                    })
                    print("[Visual Money] Valor restaurado para: " .. originalCashValue)
                    originalCashValue = nil
                end
            end
        else
            Fluent:Notify({
                Title = "Visual Money",
                Content = "Nenhum valor original salvo!",
                Duration = 3
            })
        end
    end
})

-- Aba Defesa Civil
local DefesaCivilTab = Window:AddTab({ Title = "Defesa Civil", Icon = "shield" })

-- Variáveis para controle
local targetPlayerName = ""
local targetPlayer = nil
local EspiralEnabled = false
local CopyPosEnabled = false
local espiralConnection = nil
local copyPosConnection = nil
local angle = 0

-- Input para nome do jogador
local PlayerNameInput = DefesaCivilTab:AddInput("PlayerNameInput", {
    Title = "Nome do Jogador",
    Description = "Digite o nome do jogador alvo",
    Default = "",
    Placeholder = "Ex: PlayerName123",
    Finished = false,
    Callback = function(value)
        targetPlayerName = value
        
        -- Procurar jogador
        targetPlayer = nil
        for _, player in pairs(Players:GetPlayers()) do
            if string.lower(player.Name):find(string.lower(value)) or string.lower(player.DisplayName):find(string.lower(value)) then
                targetPlayer = player
                break
            end
        end
        
        if targetPlayer then
            Fluent:Notify({
                Title = "Defesa Civil",
                Content = "Jogador encontrado: " .. targetPlayer.Name,
                Duration = 3
            })
            print("[Defesa Civil] Alvo definido: " .. targetPlayer.Name)
        else
            Fluent:Notify({
                Title = "Defesa Civil",
                Content = "Jogador não encontrado: " .. value,
                Duration = 3
            })
        end
    end
})

-- Toggle Espiral
local EspiralToggle = DefesaCivilTab:AddToggle("EspiralToggle", {
    Title = "Espiral",
    Description = "Fica girando em espiral ao redor do jogador",
    Default = false
})

EspiralToggle:OnChanged(function(state)
    EspiralEnabled = state
    
    if state then
        if not targetPlayer then
            Fluent:Notify({
                Title = "Defesa Civil - Espiral",
                Content = "Por favor, defina um jogador alvo primeiro!",
                Duration = 3
            })
            EspiralToggle:SetValue(false)
            return
        end
        
        angle = 0
        espiralConnection = RunService.Heartbeat:Connect(function()
            if LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart") and 
               targetPlayer and targetPlayer.Character and targetPlayer.Character:FindFirstChild("HumanoidRootPart") then
                
                angle = angle + 0.1 -- Velocidade da rotação
                local radius = 10 -- Distância do centro
                
                local targetPos = targetPlayer.Character.HumanoidRootPart.Position
                local x = targetPos.X + math.cos(angle) * radius
                local z = targetPos.Z + math.sin(angle) * radius
                local y = targetPos.Y
                
                LocalPlayer.Character.HumanoidRootPart.CFrame = CFrame.new(x, y, z)
            end
        end)
        
        Fluent:Notify({
            Title = "Defesa Civil - Espiral",
            Content = "Espiral ativada em " .. targetPlayer.Name,
            Duration = 3
        })
        print("[Defesa Civil] Espiral ativada")
    else
        if espiralConnection then
            espiralConnection:Disconnect()
            espiralConnection = nil
        end
        print("[Defesa Civil] Espiral desativada")
    end
end)

-- Toggle Copy Pos
local CopyPosToggle = DefesaCivilTab:AddToggle("CopyPosToggle", {
    Title = "Copy Pos",
    Description = "Fica dentro do corpo do jogador, copiando posição e rotação",
    Default = false
})

CopyPosToggle:OnChanged(function(state)
    CopyPosEnabled = state
    
    if state then
        if not targetPlayer then
            Fluent:Notify({
                Title = "Defesa Civil - Copy Pos",
                Content = "Por favor, defina um jogador alvo primeiro!",
                Duration = 3
            })
            CopyPosToggle:SetValue(false)
            return
        end
        
        copyPosConnection = RunService.Heartbeat:Connect(function()
            if LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart") and 
               targetPlayer and targetPlayer.Character and targetPlayer.Character:FindFirstChild("HumanoidRootPart") then
                
                -- Copia exatamente a posição e rotação do alvo
                local targetCFrame = targetPlayer.Character.HumanoidRootPart.CFrame
                LocalPlayer.Character.HumanoidRootPart.CFrame = targetCFrame
            end
        end)
        
        Fluent:Notify({
            Title = "Defesa Civil - Copy Pos",
            Content = "Copy Pos ativado em " .. targetPlayer.Name,
            Duration = 3
        })
        print("[Defesa Civil] Copy Pos ativado")
    else
        if copyPosConnection then
            copyPosConnection:Disconnect()
            copyPosConnection = nil
        end
        print("[Defesa Civil] Copy Pos desativado")
    end
end)

-- Botão para parar tudo
DefesaCivilTab:AddButton({
    Title = "Parar Todas Funções",
    Description = "Desativa Espiral e Copy Pos",
    Callback = function()
        EspiralToggle:SetValue(false)
        CopyPosToggle:SetValue(false)
        
        Fluent:Notify({
            Title = "Defesa Civil",
            Content = "Todas as funções foram desativadas",
            Duration = 3
        })
    end
})

-- Monitorar se o jogador alvo sai do servidor
Players.PlayerRemoving:Connect(function(player)
    if targetPlayer == player then
        EspiralToggle:SetValue(false)
        CopyPosToggle:SetValue(false)
        targetPlayer = nil
        
        Fluent:Notify({
            Title = "Defesa Civil",
            Content = "Jogador alvo saiu do servidor. Funções desativadas.",
            Duration = 3
        })
    end
end)

-- Aba Recrutamento
local RecrutamentoTab = Window:AddTab({ Title = "Recrutamento", Icon = "users" })

-- Função para enviar mensagem no chat (novo sistema)
local function sendChatMessage(message)
    local TextChatService = game:GetService("TextChatService")
    local textChannel = TextChatService.TextChannels.RBXGeneral
    if textChannel then
        textChannel:SendAsync(message)
    end
end

-- Input para mensagem personalizada
local CustomMessageInput = RecrutamentoTab:AddInput("CustomMessageInput", {
    Title = "Mensagem Personalizada",
    Description = "Digite sua própria mensagem para enviar no chat",
    Default = "",
    Placeholder = "Ex: Sim, Tenente.",
    Finished = false,
    Callback = function(value)
        if value and value ~= "" then
            sendChatMessage(value)
            Fluent:Notify({
                Title = "Recrutamento",
                Content = "Mensagem enviada: " .. value,
                Duration = 3
            })
            print("[Recrutamento] Mensagem personalizada enviada: " .. value)
        else
            Fluent:Notify({
                Title = "Recrutamento",
                Content = "Digite uma mensagem válida!",
                Duration = 3
            })
        end
    end
})

-- Seção de respostas para Cabo
RecrutamentoTab:AddParagraph({
    Title = "Respostas para Cabo",
    Content = "Clique nos botões abaixo para enviar as respostas no chat"
})

RecrutamentoTab:AddButton({
    Title = "Sim, Cabo.",
    Description = "Envia 'Sim, Cabo.' no chat",
    Callback = function()
        sendChatMessage("Sim, Cabo.")
        Fluent:Notify({
            Title = "Recrutamento",
            Content = "Enviado: Sim, Cabo.",
            Duration = 2
        })
        print("[Recrutamento] Enviado: Sim, Cabo.")
    end
})

RecrutamentoTab:AddButton({
    Title = "Não, Cabo.",
    Description = "Envia 'Não, Cabo.' no chat",
    Callback = function()
        sendChatMessage("Não, Cabo.")
        Fluent:Notify({
            Title = "Recrutamento",
            Content = "Enviado: Não, Cabo.",
            Duration = 2
        })
        print("[Recrutamento] Enviado: Não, Cabo.")
    end
})

-- Seção de respostas para Sargento
RecrutamentoTab:AddParagraph({
    Title = "Respostas para Sargento",
    Content = ""
})

RecrutamentoTab:AddButton({
    Title = "Sim, Sargento.",
    Description = "Envia 'Sim, Sargento.' no chat",
    Callback = function()
        sendChatMessage("Sim, Sargento.")
        Fluent:Notify({
            Title = "Recrutamento",
            Content = "Enviado: Sim, Sargento.",
            Duration = 2
        })
        print("[Recrutamento] Enviado: Sim, Sargento.")
    end
})

RecrutamentoTab:AddButton({
    Title = "Não, Sargento.",
    Description = "Envia 'Não, Sargento.' no chat",
    Callback = function()
        sendChatMessage("Não, Sargento.")
        Fluent:Notify({
            Title = "Recrutamento",
            Content = "Enviado: Não, Sargento.",
            Duration = 2
        })
        print("[Recrutamento] Enviado: Não, Sargento.")
    end
})

-- Seção de respostas para Subtenente
RecrutamentoTab:AddParagraph({
    Title = "Respostas para Subtenente",
    Content = ""
})

RecrutamentoTab:AddButton({
    Title = "Sim, Subtenente.",
    Description = "Envia 'Sim, Subtenente.' no chat",
    Callback = function()
        sendChatMessage("Sim, Subtenente.")
        Fluent:Notify({
            Title = "Recrutamento",
            Content = "Enviado: Sim, Subtenente.",
            Duration = 2
        })
        print("[Recrutamento] Enviado: Sim, Subtenente.")
    end
})

RecrutamentoTab:AddButton({
    Title = "Não, Subtenente.",
    Description = "Envia 'Não, Subtenente.' no chat",
    Callback = function()
        sendChatMessage("Não, Subtenente.")
        Fluent:Notify({
            Title = "Recrutamento",
            Content = "Enviado: Não, Subtenente.",
            Duration = 2
        })
        print("[Recrutamento] Enviado: Não, Subtenente.")
    end
})

-- Auto Torre (Pula no ar quando detecta queda livre)
local AutoTorreEnabled = false
local autoTorreConnection = nil
local wasOnGround = true
local hasJumpedInAir = false

local AutoTorreToggle = RecrutamentoTab:AddToggle("AutoTorreToggle", {
    Title = "Auto Torre",
    Description = "Pula automaticamente no ar quando detecta queda livre",
    Default = false
})

AutoTorreToggle:OnChanged(function(state)
    AutoTorreEnabled = state
    
    if state then
        autoTorreConnection = RunService.Heartbeat:Connect(function()
            if LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("Humanoid") and LocalPlayer.Character:FindFirstChild("HumanoidRootPart") then
                local humanoid = LocalPlayer.Character.Humanoid
                local humanoidRootPart = LocalPlayer.Character.HumanoidRootPart
                local humanoidState = humanoid:GetState()
                
                -- Verificar se está no chão
                local isOnGround = (humanoidState == Enum.HumanoidStateType.Running or 
                                  humanoidState == Enum.HumanoidStateType.RunningNoPhysics or
                                  humanoidState == Enum.HumanoidStateType.Landed)
                
                -- Reset do pulo quando toca o chão
                if isOnGround then
                    hasJumpedInAir = false
                end
                
                -- Se estava no chão e agora está caindo (queda livre detectada)
                if wasOnGround and not isOnGround and not hasJumpedInAir then
                    local velocity = humanoidRootPart.Velocity
                    
                    -- Se está caindo (velocidade Y negativa)
                    if velocity.Y < -5 then
                        -- PULAR NO AR! (forçar velocidade Y para cima)
                        humanoidRootPart.Velocity = Vector3.new(
                            velocity.X,
                            50, -- Força do pulo no ar
                            velocity.Z
                        )
                        
                        hasJumpedInAir = true
                        print("[Auto Torre] PULOU NO AR! Queda livre detectada.")
                    end
                end
                
                wasOnGround = isOnGround
            end
        end)
        
        Fluent:Notify({
            Title = "Auto Torre",
            Content = "Auto Torre ativado! Vai pular no ar em queda livre.",
            Duration = 3
        })
        print("[Auto Torre] Ativado - Pulo automático no ar")
    else
        if autoTorreConnection then
            autoTorreConnection:Disconnect()
            autoTorreConnection = nil
        end
        wasOnGround = true
        hasJumpedInAir = false
        
        Fluent:Notify({
            Title = "Auto Torre",
            Content = "Auto Torre desativado!",
            Duration = 3
        })
        print("[Auto Torre] Desativado")
    end
end)

-- Seção de ações rápidas
RecrutamentoTab:AddParagraph({
    Title = "Ações Rápidas",
    Content = "Comandos úteis para recrutamento"
})

RecrutamentoTab:AddButton({
    Title = "Limpar Chat",
    Description = "Envia várias linhas em branco para limpar o chat",
    Callback = function()
        for i = 1, 10 do
            sendChatMessage(" ")
            task.wait(0.1)
        end
        Fluent:Notify({
            Title = "Recrutamento",
            Content = "Chat limpo!",
            Duration = 2
        })
    end
})

local CreditTab = Window:AddTab({ Title = "Credits", Icon = "star" })

CreditTab:AddButton({
    Title = "Discord Server",
    Description = "",
    Callback = function()
        setclipboard("https://discord.gg/3gWvqV8Frg")
        Fluent:Notify({
            Title = "Copiado!",
            Content = "Servidor do Discord colocado na Área de Transferência",
            SubContent = "Use Ctrl+V para colar.",
            Duration = 5
        })
    end
})

local OthersTab = Window:AddTab({ Title = "Others", Icon = "help-circle" })

OthersTab:AddButton({
    Title = "Auto JJ'S por ZV YZ",
    Description = "",
    Callback = function()
        loadstring(game:HttpGet('https://raw.githubusercontent.com/Zv-yz/AutoJJs/main/Main.lua'))()
    end
})

OthersTab:AddButton({
    Title = "Infinite Yield",
    Description = "",
    Callback = function()
        loadstring(game:HttpGet(('https://raw.githubusercontent.com/EdgeIY/infiniteyield/master/source'),true))()
    end
})

OthersTab:AddButton({
    Title = "Aimbot Air",
    Description = "",
    Callback = function()
        loadstring(game:HttpGet("https://raw.githubusercontent.com/Exunys/AirHub/main/AirHub.lua"))()
    end
})



InterfaceManager:SetLibrary(Fluent)
SaveManager:SetLibrary(Fluent)

SaveManager:IgnoreThemeSettings()
SaveManager:SetIgnoreIndexes({ "AntiArrestToggle", "TpToolToggle", "AntiDetectorToggle", "InvadirBaseToggle" })

SaveManager:BuildConfigSection(Window)
InterfaceManager:BuildInterfaceSection(Window)
