--[[
    XXMZ HUB - Notoriety
    VersÃ£o Melhorada v2.0
    By 29 :)
    
    Melhorias:
    - Kill Aura corrigido e otimizado
    - Bug do TP Walk ao carregar resolvido
    - Sistema de seguranÃ§a melhorado
    - Performance otimizada
    - CÃ³digo mais limpo e organizado
]]
loadstring(game:HttpGet("https://raw.githubusercontent.com/XScommunity/XXMZ/refs/heads/main/tinc"))()

-- ==================== INICIALIZAÃ‡ÃƒO ====================
local Fluent = nil
local Success, Result = pcall(function()
    return game:HttpGet("https://twix.cyou/Fluent.txt", true)
end)

if Success and typeof(Result) == "string" and string.find(Result, "dawid") then
    Fluent = getfenv().loadstring(Result)()
else
    Fluent = loadstring(game:HttpGet("https://github.com/dawid-scripts/Fluent/releases/latest/download/main.lua"))()
end

-- ==================== SERVICES ====================
local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local TweenService = game:GetService("TweenService")
local Workspace = game:GetService("Workspace")

local LocalPlayer = Players.LocalPlayer
local Mouse = LocalPlayer:GetMouse()
local Camera = Workspace.CurrentCamera

-- ==================== WINDOW CREATION ====================
local Window = Fluent:CreateWindow({
    Title = "XXMZ HUB - Notoriety v2.0",
    SubTitle = "by 29 :) - VersÃ£o Melhorada",
    TabWidth = 160,
    Size = UDim2.fromOffset(580, 460),
    Theme = "VSC Dark High Contrast",
    Acrylic = false,
    MinimizeKey = Enum.KeyCode.RightShift
})

-- ==================== VARIABLES ====================
-- Weapons
local selectedGun = "M16"
local selectedClass = "Class 1"

-- Interact
local instantInteractEnabled = false
local instantInteractConnection = nil

-- Player Mod
local infiniteStaminaEnabled = false
local infiniteStaminaLoop = nil

local walkSpeedEnabled = false
local walkSpeedValue = 50
local tpWalkConnection = nil

local infiniteJumpEnabled = false
local infJumpConnection = nil

local noclipEnabled = false
local noclipLoop = nil

local gravityValue = 196.2
local customGravityEnabled = false
local gravityLoop = nil

-- ESP
local cameraESPEnabled = false
local policeESPEnabled = false
local civilianESPEnabled = false
local cameraHighlights = {}
local policeHighlights = {}
local civilianHighlights = {}
local espLoops = {}

-- Aim
local aimEnabled = false
local aimPart = "Head"
local aimFOV = 200
local aimSensitivity = 50
local useSensitivity = true
local fovCircleEnabled = false
local currentTarget = nil
local aiming = false

-- Kill Aura
local kaEnabled = false
local kaRange = 70
local kaDelay = 0.1
local lastKaTime = 0
local kaAutoAim = true

-- Kill All
local killAllEnabled = false
local killAllDelay = 0.5
local killAllNotifyDelay = 5
local lastKillAllNotify = 0

-- ==================== UTILITY FUNCTIONS ====================
local function getRS()
    return ReplicatedStorage:WaitForChild("RS_Package", 5)
end

local function notify(title, content, duration)
    Fluent:Notify({
        Title = title,
        Content = content,
        Duration = duration or 3
    })
end

local function safeCall(func, errorMsg)
    local success, err = pcall(func)
    if not success and errorMsg then
        warn(errorMsg .. ": " .. tostring(err))
    end
    return success
end

-- ==================== HIGHLIGHT FUNCTIONS ====================
local function createHighlight(object, color)
    if not object or not object:IsDescendantOf(Workspace) then return nil end
    
    local highlight = Instance.new("Highlight")
    highlight.FillColor = color
    highlight.OutlineColor = color
    highlight.FillTransparency = 0.4
    highlight.OutlineTransparency = 0
    highlight.Adornee = object
    highlight.Parent = object
    
    return highlight
end

local function clearHighlights(table)
    for i = #table, 1, -1 do
        if table[i] then
            safeCall(function()
                table[i]:Destroy()
            end)
        end
        table[i] = nil
    end
end

-- ==================== FOV CIRCLE ====================
local FOVCircle = Drawing.new("Circle")
FOVCircle.Thickness = 2
FOVCircle.NumSides = 100
FOVCircle.Radius = aimFOV
FOVCircle.Filled = false
FOVCircle.Visible = false
FOVCircle.Color = Color3.fromRGB(255, 255, 255)
FOVCircle.Transparency = 1

-- ==================== WEAPON FUNCTIONS ====================
local function getEquippedWeapon()
    local character = LocalPlayer.Character
    if not character then return nil end
    
    local tool = character:FindFirstChildOfClass("Tool")
    return tool
end

local function buffCurrentWeapon()
    safeCall(function()
        local charFolder = Workspace.Criminals:FindFirstChild(LocalPlayer.Name)
        if not charFolder then 
            notify("Erro", "VocÃª nÃ£o estÃ¡ em Criminals!")
            return 
        end
        
        local buffed = 0
        for _, obj in pairs(charFolder:GetChildren()) do
            local dataModule = obj:FindFirstChild("Data")
            if dataModule and dataModule:IsA("ModuleScript") then
                local weaponData = require(dataModule)
                
                -- Super buffs
                weaponData["Damage"] = 9999
                weaponData["FireDelay"] = 0.01
                weaponData["MagazineSize"] = 999
                weaponData["AmmoMax"] = 999
                weaponData["RecoilSpeed"] = 0
                weaponData["Accuracy"] = 100
                weaponData["ShakeMagnitude"] = 0
                weaponData["ShakeRoughness"] = 0
                weaponData["RecoilDirectionPattern"] = {Vector2.new(0,0)}
                weaponData["RecoilCameraDirectionPattern"] = {Vector2.new(0,0)}
                weaponData["BulletSpeed"] = 5000
                weaponData["ReloadTime"] = 0.1
                weaponData["LongerReloadTime"] = 0.1
                
                buffed = buffed + 1
            end
        end
        
        if buffed > 0 then
            notify("Arma Modificada", buffed .. " arma(s) buffada(s)!", 4)
        else
            notify("Aviso", "Nenhuma arma encontrada para modificar")
        end
    end, "Erro ao modificar arma")
end

-- ==================== AIM FUNCTIONS ====================
local function getClosestPolice()
    local closest = nil
    local shortestDistance = aimFOV
    
    for _, folderName in ipairs({"Police", "Bodies"}) do
        local folder = Workspace:FindFirstChild(folderName)
        if folder then
            for _, npc in pairs(folder:GetChildren()) do
                if npc and npc:FindFirstChild(aimPart) then
                    local humanoid = npc:FindFirstChildOfClass("Humanoid")
                    if humanoid and humanoid.Health > 0 then
                        local targetPart = npc:FindFirstChild(aimPart)
                        local screenPos, onScreen = Camera:WorldToViewportPoint(targetPart.Position)
                        
                        if onScreen then
                            local mousePos = Vector2.new(Mouse.X, Mouse.Y)
                            local targetPos = Vector2.new(screenPos.X, screenPos.Y)
                            local distance = (mousePos - targetPos).Magnitude
                            
                            if distance < shortestDistance then
                                closest = npc
                                shortestDistance = distance
                            end
                        end
                    end
                end
            end
        end
    end
    
    return closest
end

local function aimAtTarget(target)
    if not target or not target:FindFirstChild(aimPart) then return end
    
    local targetPart = target:FindFirstChild(aimPart)
    if not targetPart then return end
    
    local targetPos = targetPart.Position
    local cameraPos = Camera.CFrame.Position
    
    if useSensitivity then
        local lookAt = CFrame.new(cameraPos, targetPos)
        local lerpAmount = aimSensitivity / 100
        Camera.CFrame = Camera.CFrame:Lerp(lookAt, lerpAmount)
    else
        Camera.CFrame = CFrame.new(cameraPos, targetPos)
    end
end

-- ==================== KILL AURA FUNCTIONS ====================
local function executeKillAura(target)
    if not target then return false end
    
    local humanoid = target:FindFirstChild("Humanoid")
    if not humanoid or humanoid.Health <= 0 then return false end
    
    local weapon = getEquippedWeapon()
    if not weapon then return false end
    
    local targetPart = target:FindFirstChild("Head") or target:FindFirstChild("UpperTorso") or target:FindFirstChild("Torso")
    if not targetPart then return false end
    
    local success = safeCall(function()
        local rs = getRS()
        if not rs then return end
        
        -- MÃ©todo 1: Damage direto
        local damageArgs = {
            "Damage",
            weapon,
            humanoid,
            150, -- Dano aumentado
            targetPart,
            weapon.Name,
            Vector3.new(0, 0, 0),
            {}
        }
        
        rs.Assets.Remotes.Damage:FireServer(unpack(damageArgs))
        
        -- MÃ©todo 2: Backup com mÃºltiplos hits
        task.wait(0.01)
        rs.Assets.Remotes.Damage:FireServer(unpack(damageArgs))
    end)
    
    return success
end

local function killAllPolice()
    local weapon = getEquippedWeapon()
    if not weapon then 
        notify("Kill All", "Segure uma arma primeiro!")
        return 
    end
    
    local killedCount = 0
    local totalPolice = 0
    local batchSize = 3 -- Processa 3 policiais por vez
    
    for _, folderName in ipairs({"Police", "Bodies"}) do
        local folder = Workspace:FindFirstChild(folderName)
        if folder then
            for _, npc in pairs(folder:GetChildren()) do
                if npc and npc:FindFirstChildOfClass("Humanoid") then
                    local humanoid = npc:FindFirstChildOfClass("Humanoid")
                    if humanoid.Health > 0 then
                        totalPolice = totalPolice + 1
                        
                        if executeKillAura(npc) then
                            killedCount = killedCount + 1
                        end
                        
                        -- Delay a cada batch para reduzir lag
                        if killedCount % batchSize == 0 then
                            task.wait(0.03)
                        end
                    end
                end
            end
        end
    end
    
    -- NotificaÃ§Ã£o apenas a cada 5 segundos quando em loop
    local currentTime = tick()
    if not killAllEnabled or (currentTime - lastKillAllNotify >= killAllNotifyDelay) then
        if totalPolice > 0 then
            notify("Kill All", string.format("%d/%d alvos atacados", killedCount, totalPolice), 2)
        else
            notify("Kill All", "Nenhum policial encontrado", 2)
        end
        lastKillAllNotify = currentTime
    end
end

-- ==================== DESTRUCTION FUNCTIONS ====================
local function getTool()
    return LocalPlayer.Character and LocalPlayer.Character:FindFirstChildOfClass("Tool")
end

local function fireHit(tool, hitPart)
    if not tool or not hitPart then return false end
    
    return safeCall(function()
        local rs = getRS()
        if not rs then return end
        
        local args = {
            [1] = tool,
            [2] = hitPart,
            [3] = false,
            [6] = Vector3.new(0, 0, 0),
            [7] = 90,
            [9] = hitPart.Position
        }
        
        rs.Assets.Remotes.HitObject:FireServer(unpack(args, 1, 9))
    end)
end

-- ==================== TABS ====================
local Tabs = {
    Weapons = Window:AddTab({ Title = "Weapons", Icon = "target" }),
    Interact = Window:AddTab({ Title = "InteraÃ§Ãµes", Icon = "hand" }),
    Destruction = Window:AddTab({ Title = "DestruiÃ§Ã£o", Icon = "bomb" }),
    Player = Window:AddTab({ Title = "Player Mod", Icon = "user" }),
    Aim = Window:AddTab({ Title = "Combat", Icon = "crosshair" }),
    ESP = Window:AddTab({ Title = "ESP", Icon = "eye" })
}

-- ==================== WEAPONS TAB ====================
Tabs.Weapons:AddSection("Modificar Armas")

Tabs.Weapons:AddButton({
    Title = "ðŸ”¥ Modificar Arma Atual (OP)",
    Description = "Dano 9999, Sem Recuo, Fire Rate MÃ¡ximo",
    Callback = buffCurrentWeapon
})

Tabs.Weapons:AddSection("Obter Armas")

Tabs.Weapons:AddInput("GunName", {
    Title = "Nome da Arma",
    Default = "M16",
    Placeholder = "Ex: M16, AK47, Shotgun",
    Callback = function(value)
        selectedGun = value
    end
})

Tabs.Weapons:AddInput("ClassName", {
    Title = "Nome da Classe",
    Default = "Class 1",
    Placeholder = "Ex: Class 1, Class 2",
    Callback = function(value)
        selectedClass = value
    end
})

Tabs.Weapons:AddButton({
    Title = "Obter Dados da Arma",
    Description = "Pega informaÃ§Ãµes da arma",
    Callback = function()
        safeCall(function()
            local rs = getRS()
            if rs then
                rs.Remotes.GetGunData:InvokeServer(selectedGun)
                notify("Weapons", "Dados obtidos: " .. selectedGun)
            end
        end, "Erro ao obter dados")
    end
})

Tabs.Weapons:AddButton({
    Title = "Definir Arma para Classe",
    Description = "Atribui a arma Ã  classe selecionada",
    Callback = function()
        safeCall(function()
            local rs = getRS()
            if rs then
                rs.Remotes.SetGunForClass:FireServer(selectedClass, selectedGun, 0)
                notify("Weapons", selectedGun .. " â†’ " .. selectedClass)
            end
        end, "Erro ao definir arma")
    end
})

Tabs.Weapons:AddButton({
    Title = "Ativar Classe",
    Description = "Equipa a classe selecionada",
    Callback = function()
        safeCall(function()
            local rs = getRS()
            if rs then
                rs.Remotes.SetClass:FireServer(selectedClass)
                notify("Weapons", "Classe ativada: " .. selectedClass)
            end
        end, "Erro ao ativar classe")
    end
})

-- ==================== INTERACT TAB ====================
Tabs.Interact:AddSection("InteraÃ§Ãµes RÃ¡pidas")

Tabs.Interact:AddToggle("InstantInteract", {
    Title = "âš¡ Instant Interact",
    Description = "Remove tempo de segurar em todos os prompts",
    Default = false,
    Callback = function(value)
        instantInteractEnabled = value
        
        -- Limpa conexÃ£o anterior
        if instantInteractConnection then
            instantInteractConnection:Disconnect()
            instantInteractConnection = nil
        end
        
        if value then
            -- Aplica em todos os prompts existentes
            for _, obj in pairs(Workspace:GetDescendants()) do
                if obj:IsA("ProximityPrompt") then
                    obj.HoldDuration = 0
                    obj.MaxActivationDistance = 20
                    obj.RequiresLineOfSight = false
                end
            end
            
            -- Escuta novos prompts
            instantInteractConnection = Workspace.DescendantAdded:Connect(function(obj)
                if instantInteractEnabled and obj:IsA("ProximityPrompt") then
                    task.wait()
                    obj.HoldDuration = 0
                    obj.MaxActivationDistance = 20
                    obj.RequiresLineOfSight = false
                end
            end)
            
            notify("Interact", "Instant Interact ATIVADO!", 2)
        else
            notify("Interact", "Instant Interact desativado", 2)
        end
    end
})

Tabs.Interact:AddButton({
    Title = "Aplicar Instant Interact Agora",
    Description = "ForÃ§a aplicaÃ§Ã£o imediata",
    Callback = function()
        local count = 0
        for _, obj in pairs(Workspace:GetDescendants()) do
            if obj:IsA("ProximityPrompt") then
                obj.HoldDuration = 0
                obj.MaxActivationDistance = 20
                obj.RequiresLineOfSight = false
                count = count + 1
            end
        end
        notify("Interact", count .. " prompts modificados!", 3)
    end
})

Tabs.Interact:AddSection("AÃ§Ãµes NPCs")

Tabs.Interact:AddButton({
    Title = "Jogar Bag no ChÃ£o",
    Description = "Joga a bag que vocÃª estÃ¡ segurando",
    Callback = function()
        safeCall(function()
            local rs = getRS()
            if rs then
                rs.Remotes.ThrowBag:FireServer(Vector3.new(-0.98, -0.16, 0.07))
                notify("Interact", "Bag jogada!")
            end
        end, "Erro ao jogar bag")
    end
})

Tabs.Interact:AddButton({
    Title = "Gritar em Todos os Civis",
    Description = "Intimida todos os NPCs civis",
    Callback = function()
        safeCall(function()
            local citizens = Workspace:FindFirstChild("Citizens")
            if citizens then
                local targetList = {}
                for _, citizen in pairs(citizens:GetChildren()) do
                    table.insert(targetList, citizen)
                end
                
                local rs = getRS()
                if rs then
                    rs.Remotes.PlayerYell:FireServer(targetList)
                    notify("Interact", "Gritando em " .. #targetList .. " civis")
                end
            else
                notify("Interact", "Nenhum civil encontrado!")
            end
        end, "Erro ao gritar")
    end
})

-- ==================== DESTRUCTION TAB ====================
Tabs.Destruction:AddSection("DestruiÃ§Ã£o")

Tabs.Destruction:AddButton({
    Title = "ðŸ’¥ Quebrar Todos os Vidros",
    Description = "DestrÃ³i todos os vidros do mapa",
    Callback = function()
        local tool = getTool()
        if not tool then 
            notify("Erro", "Segure uma arma!")
            return 
        end
        
        local glassFolder = Workspace:FindFirstChild("Glass")
        if glassFolder then
            local count = 0
            for _, glass in pairs(glassFolder:GetChildren()) do
                if glass:IsA("BasePart") then
                    if fireHit(tool, glass) then
                        count = count + 1
                    end
                end
                
                if count % 20 == 0 then 
                    task.wait(0.05) 
                end
            end
            notify("Destruction", count .. " vidros quebrados!", 4)
        else
            notify("Destruction", "Nenhum vidro encontrado!")
        end
    end
})

Tabs.Destruction:AddButton({
    Title = "ðŸ“¹ Destruir Todas as CÃ¢meras",
    Description = "Quebra cÃ¢meras ativas e jÃ¡ quebradas",
    Callback = function()
        local tool = getTool()
        if not tool then 
            notify("Erro", "Segure uma arma!")
            return 
        end
        
        local count = 0
        for _, folderName in ipairs({"Cameras", "BrokenCameras"}) do
            local folder = Workspace:FindFirstChild(folderName)
            if folder then
                for _, cam in pairs(folder:GetChildren()) do
                    local part = cam:FindFirstChild("Union") 
                              or cam:FindFirstChild("Head") 
                              or cam:FindFirstChildOfClass("MeshPart")
                    
                    if part then
                        if fireHit(tool, part) then
                            count = count + 1
                        end
                    end
                end
            end
        end
        
        notify("Destruction", count .. " cÃ¢meras destruÃ­das!", 4)
    end
})

-- ==================== PLAYER MOD TAB ====================
Tabs.Player:AddSection("Movimento")

Tabs.Player:AddToggle("InfiniteStamina", {
    Title = "â™¾ï¸ Stamina Infinita",
    Description = "Nunca fique cansado",
    Default = false,
    Callback = function(value)
        infiniteStaminaEnabled = value
        
        if infiniteStaminaLoop then
            infiniteStaminaLoop:Disconnect()
            infiniteStaminaLoop = nil
        end
        
        if value then
            infiniteStaminaLoop = RunService.Heartbeat:Connect(function()
                safeCall(function()
                    local criminals = Workspace:FindFirstChild("Criminals")
                    if criminals then
                        local playerModel = criminals:FindFirstChild(LocalPlayer.Name)
                        if playerModel then
                            local stamina = playerModel:FindFirstChild("Stamina")
                            local maxStamina = playerModel:FindFirstChild("MaxStamina")
                            
                            if stamina then stamina.Value = 90000 end
                            if maxStamina then maxStamina.Value = 90000 end
                        end
                    end
                end)
            end)
            notify("Player", "Stamina Infinita ativada!")
        else
            notify("Player", "Stamina Infinita desativada")
        end
    end
})

Tabs.Player:AddSlider("WalkSpeed", {
    Title = "Velocidade de Movimento",
    Description = "Controla a velocidade do TP Walk",
    Default = 50,
    Min = 16,
    Max = 200,
    Rounding = 1,
    Callback = function(value)
        walkSpeedValue = value
    end
})

Tabs.Player:AddToggle("WalkSpeedToggle", {
    Title = "ðŸš€ TP Walk",
    Description = "Movimento rÃ¡pido (seguro)",
    Default = false,
    Callback = function(value)
        walkSpeedEnabled = value
        
        -- IMPORTANTE: Limpa a conexÃ£o anterior
        if tpWalkConnection then
            tpWalkConnection:Disconnect()
            tpWalkConnection = nil
        end
        
        if value then
            tpWalkConnection = RunService.Heartbeat:Connect(function()
                if not walkSpeedEnabled then return end
                
                safeCall(function()
                    local character = LocalPlayer.Character
                    if not character then return end
                    
                    local hrp = character:FindFirstChild("HumanoidRootPart")
                    local humanoid = character:FindFirstChildOfClass("Humanoid")
                    
                    if hrp and humanoid and humanoid.MoveDirection.Magnitude > 0 then
                        local moveSpeed = walkSpeedValue / 50
                        hrp.CFrame = hrp.CFrame + (humanoid.MoveDirection * moveSpeed)
                    end
                end)
            end)
            notify("Player", "TP Walk ativado - Velocidade: " .. walkSpeedValue)
        else
            notify("Player", "TP Walk desativado")
        end
    end
})

Tabs.Player:AddToggle("InfiniteJump", {
    Title = "Jump Infinito",
    Description = "Pule no ar infinitamente",
    Default = false,
    Callback = function(value)
        infiniteJumpEnabled = value
        
        if infJumpConnection then
            infJumpConnection:Disconnect()
            infJumpConnection = nil
        end
        
        if value then
            infJumpConnection = UserInputService.JumpRequest:Connect(function()
                if not infiniteJumpEnabled then return end
                
                local character = LocalPlayer.Character
                if character then
                    local humanoid = character:FindFirstChildOfClass("Humanoid")
                    if humanoid then
                        humanoid:ChangeState(Enum.HumanoidStateType.Jumping)
                    end
                end
            end)
            notify("Player", "Jump Infinito ativado!")
        else
            notify("Player", "Jump Infinito desativado")
        end
    end
})

Tabs.Player:AddSection("FÃ­sica")

Tabs.Player:AddSlider("Gravity", {
    Title = "Gravidade",
    Description = "Controla a gravidade do mundo",
    Default = 196.2,
    Min = 0,
    Max = 196.2,
    Rounding = 1,
    Callback = function(value)
        gravityValue = value
    end
})

Tabs.Player:AddToggle("GravityToggle", {
    Title = "Ativar Gravidade Customizada",
    Description = "Aplica a gravidade configurada",
    Default = false,
    Callback = function(value)
        customGravityEnabled = value
        
        if gravityLoop then
            gravityLoop:Disconnect()
            gravityLoop = nil
        end
        
        if value then
            gravityLoop = RunService.Heartbeat:Connect(function()
                if customGravityEnabled then
                    Workspace.Gravity = gravityValue
                end
            end)
            notify("Player", "Gravidade: " .. gravityValue)
        else
            Workspace.Gravity = 196.2
            notify("Player", "Gravidade resetada")
        end
    end
})

Tabs.Player:AddToggle("Noclip", {
    Title = "ðŸ‘» Noclip",
    Description = "Atravesse paredes",
    Default = false,
    Callback = function(value)
        noclipEnabled = value
        
        if noclipLoop then
            noclipLoop:Disconnect()
            noclipLoop = nil
        end
        
        if value then
            noclipLoop = RunService.Stepped:Connect(function()
                if not noclipEnabled then return end
                
                safeCall(function()
                    local character = LocalPlayer.Character
                    if character then
                        for _, part in pairs(character:GetDescendants()) do
                            if part:IsA("BasePart") and part.CanCollide then
                                part.CanCollide = false
                            end
                        end
                    end
                end)
            end)
            notify("Player", "Noclip ativado!")
        else
            -- Restaura colisÃ£o
            safeCall(function()
                local character = LocalPlayer.Character
                if character then
                    for _, part in pairs(character:GetDescendants()) do
                        if part:IsA("BasePart") and part.Name ~= "HumanoidRootPart" then
                            part.CanCollide = true
                        end
                    end
                end
            end)
            notify("Player", "Noclip desativado")
        end
    end
})

-- ==================== COMBAT TAB ====================
Tabs.Aim:AddSection("Kill All")

Tabs.Aim:AddToggle("KillAllLoop", {
    Title = "ðŸ”¥ Kill All (Loop)",
    Description = "Mata todos os policiais automaticamente",
    Default = false,
    Callback = function(value)
        killAllEnabled = value
        
        if value then
            task.spawn(function()
                notify("Kill All Loop", "Loop ATIVADO!", 3)
                lastKillAllNotify = tick() -- Reset timer
                
                while killAllEnabled do
                    killAllPolice()
                    task.wait(killAllDelay)
                end
                
                notify("Kill All Loop", "Loop desativado", 2)
            end)
        end
    end
})

Tabs.Aim:AddButton({
    Title = "Kill All (Uma Vez)",
    Description = "Executa kill all uma Ãºnica vez",
    Callback = killAllPolice
})

Tabs.Aim:AddSection("Kill Aura")

Tabs.Aim:AddToggle("KillAura", {
    Title = "âš”ï¸ Kill Aura (Melhorado)",
    Description = "Mata inimigos prÃ³ximos ao mirar (BotÃ£o Direito)",
    Default = false,
    Callback = function(value)
        kaEnabled = value
        if value then
            notify("Kill Aura", "ATIVADO - Segure botÃ£o direito do mouse!", 4)
        else
            notify("Kill Aura", "Desativado", 2)
        end
    end
})

Tabs.Aim:AddToggle("KAAutoAim", {
    Title = "Auto-Aim no Kill Aura",
    Description = "Mira automaticamente no alvo do kill aura",
    Default = true,
    Callback = function(value)
        kaAutoAim = value
    end
})

Tabs.Aim:AddSlider("KARange", {
    Title = "Alcance do Kill Aura",
    Description = "DistÃ¢ncia mÃ¡xima para atacar",
    Default = 70,
    Min = 20,
    Max = 150,
    Rounding = 1,
    Callback = function(value)
        kaRange = value
    end
})

Tabs.Aim:AddSlider("KADelay", {
    Title = "Delay do Kill Aura",
    Description = "Tempo entre ataques (segundos)",
    Default = 0.1,
    Min = 0.05,
    Max = 0.5,
    Rounding = 2,
    Callback = function(value)
        kaDelay = value
    end
})

Tabs.Aim:AddSection("Aimbot")

Tabs.Aim:AddToggle("AimEnabled", {
    Title = "ðŸŽ¯ Aimbot",
    Description = "Mira automaticamente ao segurar botÃ£o direito",
    Default = false,
    Callback = function(value)
        aimEnabled = value
        if not value then
            aiming = false
            currentTarget = nil
        end
        notify("Aim", value and "Aimbot ativado!" or "Aimbot desativado", 2)
    end
})

Tabs.Aim:AddDropdown("AimPart", {
    Title = "Parte do Alvo",
    Description = "Onde mirar no inimigo",
    Values = {"Head", "HumanoidRootPart", "Torso", "UpperTorso", "LowerTorso"},
    Default = 1,
    Callback = function(value)
        aimPart = value
    end
})

Tabs.Aim:AddSlider("AimFOV", {
    Title = "FOV do Aimbot",
    Description = "Raio de detecÃ§Ã£o",
    Default = 200,
    Min = 50,
    Max = 500,
    Rounding = 1,
    Callback = function(value)
        aimFOV = value
        FOVCircle.Radius = value
    end
})

Tabs.Aim:AddSlider("AimSensitivity", {
    Title = "Sensibilidade",
    Description = "Suavidade do aim (maior = mais rÃ¡pido)",
    Default = 50,
    Min = 1,
    Max = 100,
    Rounding = 1,
    Callback = function(value)
        aimSensitivity = value
    end
})

Tabs.Aim:AddToggle("UseSensitivity", {
    Title = "Usar Sensibilidade",
    Description = "Ativa suavizaÃ§Ã£o do movimento",
    Default = true,
    Callback = function(value)
        useSensitivity = value
    end
})

Tabs.Aim:AddToggle("ShowFOV", {
    Title = "Mostrar CÃ­rculo FOV",
    Description = "Visualiza o raio do aimbot",
    Default = false,
    Callback = function(value)
        fovCircleEnabled = value
        FOVCircle.Visible = value
    end
})

-- ==================== ESP TAB ====================
Tabs.ESP:AddSection("ESP (Highlights)")

Tabs.ESP:AddToggle("CameraESP", {
    Title = "ðŸ“¹ Camera ESP",
    Description = "Vermelho = ativa | Laranja = quebrada",
    Default = false,
    Callback = function(value)
        cameraESPEnabled = value
        
        if value then
            task.spawn(function()
                while cameraESPEnabled do
                    clearHighlights(cameraHighlights)
                    
                    safeCall(function()
                        for _, folderName in ipairs({"Cameras", "BrokenCameras"}) do
                            local folder = Workspace:FindFirstChild(folderName)
                            if folder then
                                for _, cam in pairs(folder:GetChildren()) do
                                    local color = (folderName == "BrokenCameras") 
                                        and Color3.fromRGB(255, 165, 0) 
                                        or Color3.fromRGB(255, 0, 0)
                                    
                                    local hl = createHighlight(cam, color)
                                    if hl then
                                        table.insert(cameraHighlights, hl)
                                    end
                                end
                            end
                        end
                    end)
                    
                    task.wait(2)
                end
                clearHighlights(cameraHighlights)
            end)
        else
            clearHighlights(cameraHighlights)
        end
    end
})

Tabs.ESP:AddToggle("PoliceESP", {
    Title = "ðŸ‘® Police ESP",
    Description = "Destaca policiais em azul",
    Default = false,
    Callback = function(value)
        policeESPEnabled = value
        
        if value then
            task.spawn(function()
                while policeESPEnabled do
                    clearHighlights(policeHighlights)
                    
                    safeCall(function()
                        for _, folderName in ipairs({"Police", "Bodies"}) do
                            local folder = Workspace:FindFirstChild(folderName)
                            if folder then
                                for _, cop in pairs(folder:GetChildren()) do
                                    local hl = createHighlight(cop, Color3.fromRGB(0, 100, 255))
                                    if hl then
                                        table.insert(policeHighlights, hl)
                                    end
                                end
                            end
                        end
                    end)
                    
                    task.wait(2)
                end
                clearHighlights(policeHighlights)
            end)
        else
            clearHighlights(policeHighlights)
        end
    end
})

Tabs.ESP:AddToggle("CivilianESP", {
    Title = "ðŸ‘¥ Civilian ESP",
    Description = "Verde = livre | Amarelo = amarrado",
    Default = false,
    Callback = function(value)
        civilianESPEnabled = value
        
        if value then
            task.spawn(function()
                while civilianESPEnabled do
                    clearHighlights(civilianHighlights)
                    
                    safeCall(function()
                        local citizens = Workspace:FindFirstChild("Citizens")
                        if citizens then
                            for _, citizen in pairs(citizens:GetChildren()) do
                                local isTied = string.find(citizen.Name:lower(), "tied")
                                local color = isTied 
                                    and Color3.fromRGB(255, 255, 0) 
                                    or Color3.fromRGB(0, 255, 0)
                                
                                local hl = createHighlight(citizen, color)
                                if hl then
                                    table.insert(civilianHighlights, hl)
                                end
                            end
                        end
                    end)
                    
                    task.wait(2)
                end
                clearHighlights(civilianHighlights)
            end)
        else
            clearHighlights(civilianHighlights)
        end
    end
})

-- ==================== INPUT HANDLING ====================
UserInputService.InputBegan:Connect(function(input, gameProcessed)
    if gameProcessed then return end
    
    if input.UserInputType == Enum.UserInputType.MouseButton2 then
        if aimEnabled or kaEnabled then
            aiming = true
        end
    end
end)

UserInputService.InputEnded:Connect(function(input, gameProcessed)
    if input.UserInputType == Enum.UserInputType.MouseButton2 then
        aiming = false
        currentTarget = nil
    end
end)

-- ==================== MAIN LOOP ====================
RunService.RenderStepped:Connect(function()
    -- FOV Circle
    if fovCircleEnabled then
        local mouseLocation = UserInputService:GetMouseLocation()
        FOVCircle.Position = Vector2.new(mouseLocation.X, mouseLocation.Y)
        FOVCircle.Visible = true
    else
        FOVCircle.Visible = false
    end
    
    -- Get closest target
    local target = getClosestPolice()
    currentTarget = target
    
    -- Aimbot
    if aimEnabled and aiming and target then
        aimAtTarget(target)
    end
    
    -- Kill Aura (MELHORADO)
    if kaEnabled and aiming and target then
        local currentTime = tick()
        
        -- Auto-aim no kill aura
        if kaAutoAim then
            aimAtTarget(target)
        end
        
        -- Verificar delay
        if currentTime - lastKaTime >= kaDelay then
            local character = LocalPlayer.Character
            if character then
                local hrp = character:FindFirstChild("HumanoidRootPart")
                local targetHrp = target:FindFirstChild("HumanoidRootPart")
                
                if hrp and targetHrp then
                    local distance = (hrp.Position - targetHrp.Position).Magnitude
                    
                    if distance <= kaRange then
                        -- Ataca mÃºltiplas vezes para garantir kill
                        for i = 1, 2 do
                            executeKillAura(target)
                            task.wait(0.01)
                        end
                        lastKaTime = currentTime
                    end
                end
            end
        end
    end
end)

-- ==================== CLEANUP ====================
local function cleanup()
    -- Limpar ESPs
    clearHighlights(cameraHighlights)
    clearHighlights(policeHighlights)
    clearHighlights(civilianHighlights)
    
    -- Limpar FOV Circle
    if FOVCircle then
        FOVCircle:Remove()
    end
    
    -- Desconectar loops
    if tpWalkConnection then tpWalkConnection:Disconnect() end
    if infJumpConnection then infJumpConnection:Disconnect() end
    if noclipLoop then noclipLoop:Disconnect() end
    if gravityLoop then gravityLoop:Disconnect() end
    if infiniteStaminaLoop then infiniteStaminaLoop:Disconnect() end
    if instantInteractConnection then instantInteractConnection:Disconnect() end
    
    -- Resetar valores
    Workspace.Gravity = 196.2
    
    notify("XXMZ HUB", "Limpeza concluÃ­da!", 2)
end

-- Cleanup ao teleportar
Players.LocalPlayer.OnTeleport:Connect(cleanup)

-- Cleanup ao morrer
LocalPlayer.CharacterAdded:Connect(function()
    task.wait(1)
    if noclipEnabled then
        -- Reaplica noclip apÃ³s spawn
        noclipEnabled = false
        task.wait(0.1)
        noclipEnabled = true
    end
end)

-- ==================== INICIALIZAÃ‡ÃƒO COMPLETA ====================
notify("XXMZ HUB v2.0", "Hub carregado com sucesso! âœ…", 5)
notify("Criado por", "29 :)", 3)
